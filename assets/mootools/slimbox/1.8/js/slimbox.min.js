/* Slimbox v1.8, (c) 2007-2009 Christophe Beyls <http://www.digitalia.be>, MIT-style license */
var Slimbox=function(){function e(){var e=O.getScroll(),t=O.getSize();$$(b,T).setStyle("left",e.x+t.x/2),h&&w.setStyles({left:e.x,top:e.y,width:t.x,height:t.y})}function t(t){["object",j?"select":"embed"].forEach(function(e){Array.forEach(document.getElementsByTagName(e),function(e){t&&(e._slimbox=e.style.visibility),e.style.visibility=t?"hidden":e._slimbox})}),w.style.display=t?"":"none";var i=t?"addEvent":"removeEvent";O[i]("scroll",e)[i]("resize",e),document[i]("keydown",n)}function n(e){var t=e.code;return d.closeKeys.contains(t)?c():d.nextKeys.contains(t)?o():d.previousKeys.contains(t)?i():!1}function i(){return l(u)}function o(){return l(p)}function l(e){return e>=0&&(C=e,m=y[e][0],u=(C||(d.loop?y.length:0))-1,p=(C+1)%y.length||(d.loop?0:-1),s(),b.className="lbLoading",N=new Image,N.onload=a,N.src=m),!1}function a(){b.className="",I.set(0),x.setStyles({backgroundImage:"url("+m+")",display:""}),E.setStyle("width",N.width),$$(E,S,k).setStyle("height",N.height),F.set("html",y[C][1]||""),z.set("html",(y.length>1&&d.counterText||"").replace(/{x}/,C+1).replace(/{y}/,y.length)),u>=0&&(B.src=y[u][0]),p>=0&&(W.src=y[p][0]),v=x.offsetWidth,g=x.offsetHeight;var e,t=Math.max(0,f-g/2),n=0;b.offsetHeight!=g&&(n=H.start({height:g,top:t})),b.offsetWidth!=v&&(n=H.start({width:v,marginLeft:-v/2})),e=function(){T.setStyles({width:v,top:t+g,marginLeft:-v/2,visibility:"hidden",display:""}),I.start(1)},n?H.chain(e):e()}function r(){u>=0&&(S.style.display=""),p>=0&&(k.style.display=""),K.set(-D.offsetHeight).start(0),T.style.visibility=""}function s(){N.onload=null,N.src=B.src=W.src=m,H.cancel(),I.cancel(),K.cancel(),$$(S,k,x,T).setStyle("display","none")}function c(){return C>=0&&(s(),C=u=p=-1,b.style.display="none",L.cancel().chain(t).start(0)),!1}var d,y,m,u,p,h,f,v,g,w,b,x,E,S,k,T,D,F,z,L,H,I,K,O=window,j=Browser.ie6,C=-1,N={},B=new Image,W=new Image;return O.addEvent("domready",function(){$(document.body).adopt($$(w=new Element("div#lbOverlay",{events:{click:c}}),b=new Element("div#lbCenter"),T=new Element("div#lbBottomContainer")).setStyle("display","none")),x=new Element("div#lbImage").inject(b).adopt(E=new Element("div",{styles:{position:"relative"}}).adopt(S=new Element("a#lbPrevLink[href=#]",{events:{click:i}}),k=new Element("a#lbNextLink[href=#]",{events:{click:o}}))),D=new Element("div#lbBottom").inject(T).adopt(new Element("a#lbCloseLink[href=#]",{events:{click:c}}),F=new Element("div#lbCaption"),z=new Element("div#lbNumber"),new Element("div",{styles:{clear:"both"}}))}),Element.implement({slimbox:function(e,t){return $$(this).slimbox(e,t),this}}),Elements.implement({slimbox:function(e,t,n){t=t||function(e){return[e.href,e.title]},n=n||function(){return!0};var i=this;return i.removeEvents("click").addEvent("click",function(){var o=i.filter(n,this);return Slimbox.open(o.map(t),o.indexOf(this),e)}),i}}),{open:function(n,i,o){return d=Object.append({loop:!1,overlayOpacity:.8,overlayFadeDuration:400,resizeDuration:400,resizeTransition:!1,initialWidth:250,initialHeight:250,imageFadeDuration:400,captionAnimationDuration:400,counterText:"Image {x} of {y}",closeKeys:[27,88,67],previousKeys:[37,80],nextKeys:[39,78]},o||{}),L=new Fx.Tween(w,{property:"opacity",duration:d.overlayFadeDuration}),H=new Fx.Morph(b,Object.append({duration:d.resizeDuration,link:"chain"},d.resizeTransition?{transition:d.resizeTransition}:{})),I=new Fx.Tween(x,{property:"opacity",duration:d.imageFadeDuration,onComplete:r}),K=new Fx.Tween(D,{property:"margin-top",duration:d.captionAnimationDuration}),"string"==typeof n&&(n=[[n,i]],i=0),f=O.getScrollTop()+O.getHeight()/2,v=d.initialWidth,g=d.initialHeight,b.setStyles({top:Math.max(0,f-g/2-40),width:v,height:g,marginLeft:-v/2,display:""}),h=j||w.currentStyle&&"fixed"!=w.currentStyle.position,h&&(w.style.position="absolute"),L.set(0).start(d.overlayOpacity),e(),t(1),y=n,d.loop=d.loop&&y.length>1,l(i)}}}();