/* MooRainbow 1.3 by Djamil Legato (w00fz) and Christopher Beloch, MIT-style license */
var MooRainbow=new Class({options:{id:"mooRainbow",prefix:"moor-",imgPath:"images/",startColor:[255,0,0],wheel:!1,onComplete:Class.empty,onChange:Class.empty},initialize:function(t,e){this.element=document.id(t),this.element&&(this.setOptions(e),this.sliderPos=0,this.pickerPos={x:0,y:0},this.backupColor=this.options.startColor,this.currentColor=this.options.startColor,this.sets={rgb:[],hsb:[],hex:[]},this.pickerClick=this.sliderClick=!1,this.layout||this.doLayout(),this.OverlayEvents(),this.sliderEvents(),this.backupEvent(),this.options.wheel&&this.wheelEvents(),this.element.addEvent("click",function(t){this.toggle(t)}.bind(this)),this.layout.overlay.setStyle("background-color",this.options.startColor.rgbToHex()),this.layout.backup.setStyle("background-color",this.backupColor.rgbToHex()),this.pickerPos.x=this.snippet("curPos").l+this.snippet("curSize","int").w,this.pickerPos.y=this.snippet("curPos").t+this.snippet("curSize","int").h,this.manualSet(this.options.startColor),this.pickerPos.x=this.snippet("curPos").l+this.snippet("curSize","int").w,this.pickerPos.y=this.snippet("curPos").t+this.snippet("curSize","int").h,this.sliderPos=this.snippet("arrPos")-this.snippet("arrSize","int"),window.khtml&&this.hide())},toggle:function(){this[this.visible?"hide":"show"]()},show:function(){this.rePosition(),this.layout.setStyle("display","block"),this.layout.set("aria-hidden","false"),this.visible=!0},hide:function(){this.layout.setStyles({display:"none"}),this.layout.set("aria-hidden","true"),this.visible=!1},manualSet:function(t,e){(!e||"hsb"!=e&&"hex"!=e)&&(e="rgb");var s,i,n;"rgb"==e?(s=t,i=t.rgbToHsb(),n=t.rgbToHex()):"hsb"==e?(i=t,s=t.hsbToRgb(),n=s.rgbToHex()):(n=t,s=t.hexToRgb(!0),i=s.rgbToHsb()),this.setMooRainbow(s),this.autoSet(i)},autoSet:function(t){var e,s=this.snippet("curSize","int").h,i=this.snippet("curSize","int").w,n=this.layout.overlay.height,o=this.layout.overlay.width,a=this.layout.slider.height,h=this.snippet("arrSize","int"),r=Math.round(o*t[1]/100-i),l=Math.round(-(n*t[2]/100)+n-s),u=Math.round(a*t[0]/360);u=360==u?0:u;var c=a-u+this.snippet("slider")-h;e=[this.sets.hsb[0],100,100].hsbToRgb().rgbToHex(),this.layout.cursor.setStyles({top:l,left:r}),this.layout.arrows.setStyle("top",c),this.layout.overlay.setStyle("background-color",e),this.sliderPos=this.snippet("arrPos")-h,this.pickerPos.x=this.snippet("curPos").l+i,this.pickerPos.y=this.snippet("curPos").t+s},setMooRainbow:function(t,e){(!e||"hsb"!=e&&"hex"!=e)&&(e="rgb");var s,i,n;"rgb"==e?(s=t,i=t.rgbToHsb(),n=t.rgbToHex()):"hsb"==e?(i=t,s=t.hsbToRgb(),n=s.rgbToHex()):(n=t,s=t.hexToRgb(),i=s.rgbToHsb()),this.sets={rgb:s,hsb:i,hex:n},this.pickerPos.x||this.autoSet(i),this.RedInput.value=s[0],this.GreenInput.value=s[1],this.BlueInput.value=s[2],this.HueInput.value=i[0],this.SatuInput.value=i[1],this.BrighInput.value=i[2],this.hexInput.value=n,this.currentColor=s,this.chooseColor.setStyle("background-color",s.rgbToHex()),this.fireEvent("onChange",[this.sets,this])},parseColors:function(t,e,s){var i=Math.round(100*t/this.layout.overlay.width),n=100-Math.round(100*e/this.layout.overlay.height),o=360-Math.round(360*s/this.layout.slider.height)+this.snippet("slider")-this.snippet("arrSize","int");return o-=this.snippet("arrSize","int"),o=o>=360?0:0>o?0:o,i=i>100?100:0>i?0:i,n=n>100?100:0>n?0:n,[o,i,n]},OverlayEvents:function(){var t,e,s,i;e=this.snippet("curSize","int").h,s=this.snippet("curSize","int").w,i=this.arrRGB.concat(this.arrHSB,this.hexInput),document.addEvent("click",function(){this.visible&&this.hide(this.layout)}.bind(this)),i.each(function(t){t.addEvent("keydown",this.eventKeydown.bind(this,t)),t.addEvent("keyup",this.eventKeyup.bind(this,t))},this),[this.element,this.layout].each(function(t){t.addEvents({click:function(t){t.stop()},keyup:function(t){"esc"==t.key&&this.visible&&this.hide(this.layout)}.bind(this)},this)},this),t={x:[0-s,this.layout.overlay.width-s],y:[0-e,this.layout.overlay.height-e]},this.layout.drag=new Drag(this.layout.cursor,{onStart:this.overlayDrag.bind(this),onDrag:this.overlayDrag.bind(this),snap:0}),this.layout.overlay2.addEvent("mousedown",function(t){this.layout.cursor.setStyles({top:t.page.y-this.layout.overlay.getTop()-e,left:t.page.x-this.layout.overlay.getLeft()-s}),this.overlayDrag.call(this),this.layout.drag.start(t)}.bind(this)),this.okButton.addEvent("click",function(){this.currentColor==this.options.startColor?(this.hide(),this.fireEvent("onComplete",[this.sets,this])):(this.backupColor=this.currentColor,this.layout.backup.setStyle("background-color",this.backupColor.rgbToHex()),this.hide(),this.fireEvent("onComplete",[this.sets,this]))}.bind(this))},overlayDrag:function(){var t=this.snippet("curSize","int").h,e=this.snippet("curSize","int").w;this.pickerPos.x=this.snippet("curPos").l+e,this.pickerPos.y=this.snippet("curPos").t+t,this.setMooRainbow(this.parseColors(this.pickerPos.x,this.pickerPos.y,this.sliderPos),"hsb"),this.fireEvent("onChange",[this.sets,this])},sliderEvents:function(){var t,e=this.snippet("arrSize","int");t=[0+this.snippet("slider")-e,this.layout.slider.height-e+this.snippet("slider")],this.layout.sliderDrag=new Drag(this.layout.arrows,{limit:{y:t},modifiers:{x:!1},onStart:this.sliderDrag.bind(this),onDrag:this.sliderDrag.bind(this),snap:0}),this.layout.slider.addEvent("mousedown",function(t){this.layout.arrows.setStyle("top",t.page.y-this.layout.slider.getTop()+this.snippet("slider")-e),this.sliderDrag.call(this),this.layout.sliderDrag.start(t)}.bind(this))},sliderDrag:function(){var t,e=this.snippet("arrSize","int");this.sliderPos=this.snippet("arrPos")-e,this.setMooRainbow(this.parseColors(this.pickerPos.x,this.pickerPos.y,this.sliderPos),"hsb"),t=[this.sets.hsb[0],100,100].hsbToRgb().rgbToHex(),this.layout.overlay.setStyle("background-color",t),this.fireEvent("onChange",[this.sets,this])},backupEvent:function(){this.layout.backup.addEvent("click",function(){this.manualSet(this.backupColor),this.fireEvent("onChange",[this.sets,this])}.bind(this))},wheelEvents:function(){var t=this.arrRGB.copy().extend(this.arrHSB);t.each(function(t){t.addEvents({mousewheel:function(e){this.eventKeys(e,t)}.bind(this),keydown:function(e){this.eventKeys(e,t)}.bind(this)})},this),[this.layout.arrows,this.layout.slider].each(function(t){t.addEvents({mousewheel:function(t){this.eventKeys(t,this.arrHSB[0],"slider")}.bind(this),keydown:function(t){this.eventKeys(t,this.arrHSB[0],"slider")}.bind(this)})},this)},eventKeys:function(t,e,s){var i,n;if(s=s?this.arrHSB[0]:e.id,"keydown"==t.type)if("up"==t.key)i=1;else{if("down"!=t.key)return;i=-1}else t.type==Element.Events.mousewheel.type&&(i=t.wheel>0?1:-1);if(n=this.arrRGB.test(e)?"rgb":this.arrHSB.test(e)?"hsb":"hsb","rgb"==n){var o,a=this.sets.rgb,h=this.sets.hsb,r=this.options.prefix,l=e.value.toInt()+i;switch(l=l>255?255:0>l?0:l,e.className){case r+"rInput":o=[l,a[1],a[2]];break;case r+"gInput":o=[a[0],l,a[2]];break;case r+"bInput":o=[a[0],a[1],l];break;default:o=a}this.manualSet(o),this.fireEvent("onChange",[this.sets,this])}else{var o,a=this.sets.rgb,h=this.sets.hsb,r=this.options.prefix,l=e.value.toInt()+i;switch(l=e.className.test(/(HueInput)/)?l>359?0:0>l?0:l:l>100?100:0>l?0:l,e.className){case r+"HueInput":o=[l,h[1],h[2]];break;case r+"SatuInput":o=[h[0],l,h[2]];break;case r+"BrighInput":o=[h[0],h[1],l];break;default:o=h}this.manualSet(o,"hsb"),this.fireEvent("onChange",[this.sets,this])}t.stop()},eventKeydown:function(t,e){var s=e.code,i=e.key;t.className.test(/hexInput/)||s>=48&&57>=s||"backspace"==i||"tab"==i||"delete"==i||"left"==i||"right"==i||e.stop()},eventKeyup:function(t,e){var s,i,n=e.code,o=e.key,a=t.value.charAt(0);if(t.value||0===t.value){if(t.className.test(/hexInput/)){if("#"!=a&&6!=t.value.length)return;if("#"==a&&7!=t.value.length)return}else if(!(n>=48&&57>=n)&&!["backspace","tab","delete","left","right"].test(o)&&t.value.length>3)return;if(i=this.options.prefix,t.className.test(/(rInput|gInput|bInput)/)){if(t.value<0||t.value>255)return;switch(t.className){case i+"rInput":s=[t.value,this.sets.rgb[1],this.sets.rgb[2]];break;case i+"gInput":s=[this.sets.rgb[0],t.value,this.sets.rgb[2]];break;case i+"bInput":s=[this.sets.rgb[0],this.sets.rgb[1],t.value];break;default:s=this.sets.rgb}this.manualSet(s),this.fireEvent("onChange",[this.sets,this])}else if(t.className.test(/hexInput/)){if(s=t.value.hexToRgb(!0),isNaN(s[0])||isNaN(s[1])||isNaN(s[2]))return;(s||0===s)&&(this.manualSet(s),this.fireEvent("onChange",[this.sets,this]))}else{if(t.className.test(/HueInput/)&&t.value<0||t.value>360)return;if(t.className.test(/HueInput/)&&360==t.value)t.value=0;else if(t.className.test(/(SatuInput|BrighInput)/)&&t.value<0||t.value>100)return;switch(t.className){case i+"HueInput":s=[t.value,this.sets.hsb[1],this.sets.hsb[2]];break;case i+"SatuInput":s=[this.sets.hsb[0],t.value,this.sets.hsb[2]];break;case i+"BrighInput":s=[this.sets.hsb[0],this.sets.hsb[1],t.value];break;default:s=this.sets.hsb}this.manualSet(s,"hsb"),this.fireEvent("onChange",[this.sets,this])}}},doLayout:function(){var t=this.options.id,e=this.options.prefix,s=t+" ."+e;this.layout=new Element("div",{styles:{display:"block",position:"absolute"},id:t}).inject(document.body);var i=new Element("div",{styles:{position:"relative"},"class":e+"box"}).inject(this.layout),n=new Element("div",{styles:{position:"absolute",overflow:"hidden"},"class":e+"overlayBox"}).inject(i),o=new Element("div",{styles:{position:"absolute",zIndex:1},"class":e+"arrows"}).inject(i);o.width=o.getStyle("width").toInt(),o.height=o.getStyle("height").toInt();var a=new Element("img",{styles:{"background-color":"#fff",position:"relative",zIndex:2},src:this.options.imgPath+"moor_woverlay.png","class":e+"overlay"}).inject(n),h=new Element("img",{styles:{position:"absolute",top:0,left:0,zIndex:2},src:this.options.imgPath+"moor_boverlay.png","class":e+"overlay"}).inject(n);if(window.ie6){n.setStyle("overflow","");var r=a.src;a.src=this.options.imgPath+"blank.gif",a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+r+"', sizingMethod='scale')",r=h.src,h.src=this.options.imgPath+"blank.gif",h.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+r+"', sizingMethod='scale')"}a.width=h.width=n.getStyle("width").toInt(),a.height=h.height=n.getStyle("height").toInt();var l=new Element("div",{styles:{overflow:"hidden",position:"absolute",zIndex:2},"class":e+"cursor"}).inject(n);l.width=l.getStyle("width").toInt(),l.height=l.getStyle("height").toInt();var u=new Element("img",{styles:{position:"absolute","z-index":2},src:this.options.imgPath+"moor_slider.png","class":e+"slider"}).inject(i);this.layout.slider=Slick.find(document,"#"+s+"slider"),u.width=u.getStyle("width").toInt(),u.height=u.getStyle("height").toInt(),new Element("div",{styles:{position:"absolute"},"class":e+"colorBox"}).inject(i),new Element("div",{styles:{zIndex:2,position:"absolute"},"class":e+"chooseColor"}).inject(i),this.layout.backup=new Element("div",{styles:{zIndex:2,position:"absolute",cursor:"pointer"},"class":e+"currentColor"}).inject(i);var c=new Element("label").inject(i).setStyle("position","absolute"),p=c.clone().inject(i).addClass(e+"gLabel").appendText("G: "),d=c.clone().inject(i).addClass(e+"bLabel").appendText("B: ");c.appendText("R: ").addClass(e+"rLabel");{var b=new Element("input").set("disabled",!0);b.clone().inject(p).addClass(e+"gInput"),b.clone().inject(d).addClass(e+"bInput")}b.inject(c).addClass(e+"rInput");var y=new Element("label").inject(i).setStyle("position","absolute"),g=y.clone().inject(i).addClass(e+"SatuLabel").appendText("S: "),v=y.clone().inject(i).addClass(e+"BrighLabel").appendText("B: ");y.appendText("H: ").addClass(e+"HueLabel");{var f=new Element("input").set("disabled",!0);f.clone().inject(g).addClass(e+"SatuInput"),f.clone().inject(v).addClass(e+"BrighInput")}f.inject(y).addClass(e+"HueInput"),g.appendText(" %"),v.appendText(" %"),new Element("span",{styles:{position:"absolute"},"class":e+"ballino"}).set("html"," &deg;").inject(y,"after");new Element("label").inject(i).setStyle("position","absolute").addClass(e+"hexLabel").appendText("#hex: ").adopt(new Element("input").addClass(e+"hexInput")),new Element("input",{styles:{position:"absolute"},type:"button",value:"Select","class":e+"okButton"}).inject(i);this.rePosition();var m=$$("#"+s+"overlay");this.layout.overlay=m[0],this.layout.overlay2=m[1],this.layout.cursor=Slick.find(document,"#"+s+"cursor"),this.layout.arrows=Slick.find(document,"#"+s+"arrows"),this.chooseColor=Slick.find(document,"#"+s+"chooseColor"),this.layout.backup=Slick.find(document,"#"+s+"currentColor"),this.RedInput=Slick.find(document,"#"+s+"rInput"),this.GreenInput=Slick.find(document,"#"+s+"gInput"),this.BlueInput=Slick.find(document,"#"+s+"bInput"),this.HueInput=Slick.find(document,"#"+s+"HueInput"),this.SatuInput=Slick.find(document,"#"+s+"SatuInput"),this.BrighInput=Slick.find(document,"#"+s+"BrighInput"),this.hexInput=Slick.find(document,"#"+s+"hexInput"),this.arrRGB=[this.RedInput,this.GreenInput,this.BlueInput],this.arrHSB=[this.HueInput,this.SatuInput,this.BrighInput],this.okButton=Slick.find(document,"#"+s+"okButton"),this.layout.cursor.setStyle("background-image","url("+this.options.imgPath+"moor_cursor.gif)"),window.khtml||this.hide()},rePosition:function(){var t=this.element.getCoordinates();this.layout.setStyles({left:t.left-325,top:t.top+t.height+8})},snippet:function(t,e){var s;switch(e=e?e:"none",t){case"arrPos":var i=this.layout.arrows.getStyle("top").toInt();s=i;break;case"arrSize":var n=this.layout.arrows.height;n="int"==e?(n/2).toInt():n,s=n;break;case"curPos":var o=this.layout.cursor.getStyle("left").toInt(),i=this.layout.cursor.getStyle("top").toInt();s={l:o,t:i};break;case"slider":var i=this.layout.slider.getStyle("marginTop").toInt();s=i;break;default:var n=this.layout.cursor.height,a=this.layout.cursor.width;n="int"==e?(n/2).toInt():n,a="int"==e?(a/2).toInt():a,s={w:a,h:n}}return s}});MooRainbow.implement(new Options),MooRainbow.implement(new Events);